<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuranicSentiment</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="./icon.png">
    <style>
        :root {
            --primary-color: #2C3E50;
            --secondary-color: #34495E;
            --accent-color: #E67E22;
            --background-color: #ECF0F3;
            --card-background: #FFFFFF;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --transition-speed: 0.4s;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background-color);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(44, 62, 80, 0.02) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(230, 126, 34, 0.03) 0%, transparent 20%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            background-color: var(--card-background);
            border-radius: 30px;
            box-shadow: 
                20px 20px 60px var(--shadow-color),
                -20px -20px 60px rgba(255, 255, 255, 0.8);
            padding: 3.5rem;
            margin: 2rem;
            transition: all var(--transition-speed);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, #E67E22, #F1C40F);
            opacity: 0.8;
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.75rem;
            font-weight: 600;
            margin-bottom: 2.5rem;
            text-align: center;
            letter-spacing: -0.5px;
            position: relative;
        }

        h1::after {
            content: '';
            display: block;
            width: 60px;
            height: 4px;
            background: var(--accent-color);
            margin: 1rem auto 0;
            border-radius: 2px;
            opacity: 0.7;
        }

        .button-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.75rem;
            margin: 3rem auto;
            max-width: 800px;
            justify-content: center;
            align-items: center;
        }

        button {
            padding: 1.3rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--primary-color);
            transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.3px;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0),
                rgba(255, 255, 255, 0.2),
                rgba(255, 255, 255, 0)
            );
            transition: all 0.6s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .joyful { background: linear-gradient(135deg, #F1C40F, #F39C12); }
        .peaceful { background: linear-gradient(135deg, #27AE60, #2ECC71); }
        .fearful { background: linear-gradient(135deg, #E74C3C, #C0392B); }
        .angry { background: linear-gradient(135deg, #E74C3C, #C0392B); }
        .remorseful { background: linear-gradient(135deg, #3498DB, #2980B9); }
        .reflective { background: linear-gradient(135deg, #9B59B6, #8E44AD); }

        .input-container {
            margin: 2.5rem 0;
            display: flex;
            gap: 1.25rem;
            width: 100%;
        }

        .emotion-input {
            flex: 1;
            padding: 1.2rem 1.75rem;
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: 16px;
            font-size: 1.1rem;
            font-family: 'Poppins', sans-serif;
            transition: all var(--transition-speed);
            background: rgba(255, 255, 255, 0.9);
        }

        .emotion-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 8px 20px rgba(230, 126, 34, 0.1);
        }

        .analyze-button {
            padding: 1.2rem 2.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 16px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        #verse-display {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 3rem;
            margin-top: 3rem;
            box-shadow: 
                0 15px 35px var(--shadow-color),
                inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            transition: all var(--transition-speed);
        }

        .verse-text {
            font-size: 1.35rem;
            line-height: 1.9;
            color: var(--primary-color);
            margin-bottom: 1.75rem;
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .verse-reference {
            font-style: italic;
            color: var(--secondary-color);
            font-size: 1.1rem;
            font-weight: 300;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .container {
                padding: 2.5rem;
                margin: 1rem;
            }

            h1 {
                font-size: 2.2rem;
            }

            .button-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.25rem;
            }

            .verse-text {
                font-size: 1.2rem;
            }
        }

        .description {
            text-align: center;
            color: var(--secondary-color);
            font-size: 1.1rem;
            line-height: 1.6;
            margin: -1rem auto 2rem;
            max-width: 600px;
            opacity: 0.9;
        }

        .response-text {
            font-size: 1.1rem;
            color: var(--accent-color);
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 500;
            opacity: 0.9;
        }

        .verse-context {
            font-size: 1rem;
            color: var(--secondary-color);
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(44, 62, 80, 0.05);
            border-radius: 12px;
            line-height: 1.6;
        }

        .related-verses {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .analytics-container {
            position: fixed;
            right: 2rem;
            top: 2rem;
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quranic Verses by Emotion</h1>
        <p class="description">
            Share how you're feeling through the buttons below or describe your emotions in the text box. 
            We'll provide you with a Quranic verse that offers guidance, comfort, or reflection based on your emotional state.
        </p>
        <div class="button-container">
            <button class="joyful" onclick="getVerse('joyful', this)">Joyful</button>
            <button class="peaceful" onclick="getVerse('peaceful')">Peaceful</button>
            <button class="fearful" onclick="getVerse('fearful')">Fearful</button>
            <button class="angry" onclick="getVerse('angry')">Angry</button>
            <button class="remorseful" onclick="getVerse('remorseful')">Remorseful</button>
            <button class="reflective" onclick="getVerse('reflective')">Reflective</button>
        </div>
        <div class="input-container">
            <input 
                type="text" 
                id="emotion-input" 
                placeholder="Describe how you're feeling..."
                class="emotion-input"
            >
            <button onclick="analyzeEmotion()" class="analyze-button">Analyze</button>
        </div>
        <div id="verse-display">
            <p class="verse-text">Select an emotion to receive a verse...</p>
            <p class="verse-reference"></p>
        </div>
    </div>

    <script>
        // First, let's define our emotions and their keywords
        const emotionKeywords = {
            joyful: ['happy', 'joy', 'delight', 'blessed', 'grateful', 'thankful'],
            peaceful: ['peace', 'calm', 'tranquil', 'serene'],
            fearful: ['fear', 'scared', 'afraid', 'anxious', 'worried'],
            angry: ['angry', 'mad', 'furious', 'rage', 'upset'],
            remorseful: ['sorry', 'regret', 'guilt', 'ashamed'],
            reflective: ['think', 'ponder', 'contemplate', 'wonder']
        };

        const sentimentMap = {
            "angry": "peaceful",     // When angry, provide calming verses
            "fearful": "peaceful",   // When afraid, provide reassuring verses
            "remorseful": "joyful",  // When regretful, provide hopeful verses
            "reflective": "joyful",  // When contemplative, provide uplifting verses
            "joyful": "reflective",  // When joyful, provide grounding verses
            "peaceful": "reflective" // When peaceful, provide wisdom verses
        };

        const analyticsData = {
            interactions: {},
            emotionDistribution: {},
            sentimentScores: []
        };

        function trackInteraction(emotion, source) {
            if (!analyticsData.interactions[emotion]) {
                analyticsData.interactions[emotion] = {
                    buttonClicks: 0,
                    textInputs: 0,
                    versesShown: 0
                };
            }
            analyticsData.interactions[emotion][source]++;
        }

        async function getVerse(emotion, buttonElement = null) {
            try {
                if (buttonElement) {
                    buttonElement.style.transform = 'scale(0.95)';
                    setTimeout(() => buttonElement.style.transform = 'translateY(-5px)', 200);
                }

                const jsonUrl = 'https://raw.githubusercontent.com/ymorsi7/QuranicSentiment/main/quran.json';
                const response = await fetch(jsonUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const allVerses = [];

                // Get the mapped emotion from our sentiment map
                const mappedEmotion = sentimentMap[emotion] || emotion;

                // Process each surah in the children array
                if (data && Array.isArray(data.children)) {
                    for (const surah of data.children) {
                        if (surah && Array.isArray(surah.children)) {
                            for (const verse of surah.children) {
                                if (verse && verse.ayah_en && verse.value !== undefined) {
                                    const verseEmotion = determineEmotion(verse.ayah_en, verse.value);
                                    // Use the mapped emotion to find verses
                                    if (verseEmotion === mappedEmotion) {
                                        allVerses.push(verse);
                                    }
                                }
                            }
                        }
                    }
                }

                if (allVerses.length === 0) {
                    throw new Error('No verses found for this emotion');
                }

                const verse = allVerses[Math.floor(Math.random() * allVerses.length)];
                
                const verseDisplay = document.getElementById('verse-display');
                verseDisplay.style.opacity = '0';
                
                setTimeout(() => {
                    // Use the updateVerseDisplay function instead of directly updating the content
                    updateVerseDisplay(emotion, mappedEmotion, verse);
                    verseDisplay.style.opacity = '1';
                }, 300);
            } catch (error) {
                console.error('Error fetching verse:', error);
                document.querySelector('.verse-text').textContent = 'Please try another emotion...';
                document.querySelector('.verse-reference').textContent = '';
            }
        }

        function determineEmotion(text, value) {
            // For Quranic verses analysis
            const emotionalWords = {
                joyful: ['paradise', 'reward', 'blessed', 'mercy', 'glad', 'rejoice', 'happy', 'delight', 
                         'pleasure', 'bliss', 'joy', 'garden', 'success', 'triumph', 'victory'],
                peaceful: ['peace', 'tranquil', 'calm', 'gentle', 'harmony', 'serene', 'quiet', 'still',
                          'rest', 'ease', 'comfort', 'secure', 'safe', 'protect', 'guide'],
                fearful: ['fear', 'punishment', 'warning', 'terrible', 'severe', 'doom', 'torment',
                         'horror', 'dread', 'terror', 'frightful', 'awful', 'painful'],
                angry: ['wrath', 'curse', 'condemn', 'destroy', 'vengeance', 'fury', 'rage',
                       'anger', 'punishment', 'disgrace', 'humiliate'],
                remorseful: ['forgive', 'repent', 'sorry', 'regret', 'mercy', 'pardon', 'forgiveness',
                            'guilt', 'shame', 'wrong', 'sin', 'mistake'],
                reflective: ['ponder', 'think', 'reflect', 'contemplate', 'consider', 'remember',
                            'understand', 'wisdom', 'sign', 'lesson']
            };

            if (!text || typeof text !== 'string') return 'reflective';
            text = text.toLowerCase();

            // Check emotional words first
            for (const [emotion, words] of Object.entries(emotionalWords)) {
                if (words.some(word => text.includes(word))) {
                    return emotion;
                }
            }

            // Fallback to value-based determination
            if (value >= 25) return 'joyful';
            if (value >= 20) return 'peaceful';
            if (value >= 15) return 'reflective';
            if (value >= 10) return 'remorseful';
            if (value >= 5) return 'angry';
            return 'fearful';
        }

        function analyzeEmotion() {
            // For user input analysis
            const conversationalWords = {
                joyful: ['happy', 'excited', 'delighted', 'glad', 'cheerful', 'thrilled',
                         'wonderful', 'fantastic', 'amazing', 'great', 'love', 'enjoy'],
                peaceful: ['calm', 'relaxed', 'peaceful', 'quiet', 'tranquil', 'serene',
                          'content', 'comfortable', 'safe', 'secure', 'balanced'],
                fearful: ['scared', 'afraid', 'worried', 'anxious', 'nervous', 'terrified',
                         'frightened', 'uneasy', 'stressed', 'panicked'],
                angry: ['angry', 'mad', 'furious', 'annoyed', 'irritated', 'frustrated',
                       'upset', 'outraged', 'hate', 'bitter'],
                remorseful: ['sorry', 'regret', 'guilty', 'ashamed', 'apologetic', 'bad',
                            'mistake', 'fault', 'disappointed'],
                reflective: ['think', 'wonder', 'consider', 'realize', 'understand', 'feel',
                            'sense', 'believe', 'suppose', 'guess']
            };

            const input = document.getElementById('emotion-input').value.toLowerCase();
            if (!input.trim()) return;

            let matchedEmotion = null;
            let highestScore = 0;

            for (const [emotion, keywords] of Object.entries(conversationalWords)) {
                const score = keywords.reduce((count, keyword) => {
                    return count + (input.includes(keyword) ? 1 : 0);
                }, 0);

                if (score > highestScore) {
                    highestScore = score;
                    matchedEmotion = emotion;
                }
            }

            if (matchedEmotion) {
                const matchedButton = document.querySelector(`.button-container .${matchedEmotion}`);
                if (matchedButton) {
                    matchedButton.style.transform = 'scale(0.95)';
                    setTimeout(() => matchedButton.style.transform = 'translateY(-5px)', 200);
                }
                getVerse(matchedEmotion, matchedButton);
            } else {
                const reflectiveButton = document.querySelector('.button-container .reflective');
                if (reflectiveButton) {
                    reflectiveButton.style.transform = 'scale(0.95)';
                    setTimeout(() => reflectiveButton.style.transform = 'translateY(-5px)', 200);
                }
                getVerse('reflective', reflectiveButton);
            }
        }

        function updateVerseDisplay(emotion, mappedEmotion, verse) {
            const verseDisplay = document.getElementById('verse-display');
            const responseText = document.createElement('p');
            responseText.className = 'response-text';
            responseText.textContent = `It seems you're feeling ${emotion}, so here is a verse containing ${mappedEmotion} wisdom:`;
            
            verseDisplay.innerHTML = '';
            verseDisplay.appendChild(responseText);
            
            const verseText = document.createElement('p');
            verseText.className = 'verse-text';
            verseText.textContent = verse.ayah_en;
            
            const verseReference = document.createElement('p');
            verseReference.className = 'verse-reference';
            verseReference.textContent = `${verse.surah_name_en}, Verse ${verse.ayah_no_surah}`;
            
            verseDisplay.appendChild(verseText);
            verseDisplay.appendChild(verseReference);
            
            // Add context and explanation
            const explanationText = document.createElement('p');
            explanationText.className = 'verse-context';
            explanationText.textContent = `This verse was chosen because it contains themes of ${mappedEmotion} 
                that can help transform feelings of ${emotion} through Quranic wisdom.`;
            
            const relatedVerses = findRelatedVerses(verse, 3); // Show 3 related verses
            const relatedVersesContainer = createRelatedVersesDisplay(relatedVerses);
            
            verseDisplay.appendChild(explanationText);
            verseDisplay.appendChild(relatedVersesContainer);
        }

        function findRelatedVerses(currentVerse, count = 3) {
            // Get verses from the same surah
            const relatedVerses = [];
            if (!currentVerse || !currentVerse.surah_name_en) return relatedVerses;

            try {
                // Get verses before and after the current verse
                const currentVerseNumber = parseInt(currentVerse.ayah_no_surah);
                for (let i = Math.max(1, currentVerseNumber - 1); i <= currentVerseNumber + 1; i++) {
                    if (i !== currentVerseNumber) {
                        relatedVerses.push({
                            ayah_en: `Verse ${i} context will be loaded on demand`,
                            surah_name_en: currentVerse.surah_name_en,
                            ayah_no_surah: i
                        });
                    }
                }
            } catch (error) {
                console.error('Error finding related verses:', error);
            }

            return relatedVerses.slice(0, count);
        }

        function createRelatedVersesDisplay(relatedVerses) {
            const container = document.createElement('div');
            container.className = 'related-verses';
            
            if (relatedVerses.length === 0) return container;

            const heading = document.createElement('h3');
            heading.textContent = 'Related Verses';
            heading.style.fontSize = '1.1rem';
            heading.style.marginBottom = '1rem';
            heading.style.color = 'var(--secondary-color)';
            container.appendChild(heading);

            relatedVerses.forEach(verse => {
                const verseElement = document.createElement('p');
                verseElement.className = 'verse-reference';
                verseElement.textContent = `${verse.surah_name_en}, Verse ${verse.ayah_no_surah}`;
                verseElement.style.cursor = 'pointer';
                verseElement.style.marginBottom = '0.5rem';
                verseElement.onclick = () => getVerse(verse.emotion || 'reflective');
                container.appendChild(verseElement);
            });

            return container;
        }
    </script>
</body>
</html> 